<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçõ Customer Management - SpicyPOS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Roboto+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


    <link rel="stylesheet" href="../styles/Customer.css">

</head>
<body>
<!-- Mobile Toggle -->
<button class="toggle-sidebar" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
</button>
<!-- SIDEBAR -->
<nav class="sidebar" id="sidebar">
    <div class="logo">
        <i class="fas fa-pepper-hot"></i>
        <h2>SpicyPOS</h2>
    </div>
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="../Index.html" class="nav-link">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="Customer.html" class="nav-link active">
                <i class="fas fa-users"></i>
                <span>Customers</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="Item.html" class="nav-link">
                <i class="fas fa-utensils"></i>
                <span>Manage Items</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="Order.html" class="nav-link">
                <i class="fas fa-shopping-cart"></i>
                <span>Place Order</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="OrderHistory.html" class="nav-link">
                <i class="fas fa-history"></i>
                <span>Order History</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="nav-link">
                <i class="fas fa-chart-line"></i>
                <span>Analytics</span>
            </a>
        </li>
    </ul>
    <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
    </button>
</nav>
<!-- MAIN CONTENT -->
<main class="main-content animate-slide">
    <!-- HEADER -->
    <div class="header animate-fade">
        <div class="header-left">
            <h1><i class="fas fa-users"></i> Customer Management</h1>
            <p>Manage your customer database efficiently</p>
        </div>
    </div>
    <!-- FORM CARD -->
    <div class="form-card">
        <div class="form-title">
            <i class="fas fa-user-edit"></i>
            Customer Information
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label for="customer-id"><i class="fas fa-id-badge"></i> Customer ID</label>
                <input type="text" id="customer-id" placeholder="Enter customer ID">
            </div>
            <div class="form-group">
                <label for="customer-name"><i class="fas fa-user"></i> Full Name</label>
                <input type="text" id="customer-name" placeholder="Enter full name">
            </div>
            <div class="form-group">
                <label for="customer-address"><i class="fas fa-map-marker-alt"></i> Address</label>
                <input type="text" id="customer-address" placeholder="Enter address">
            </div>
            <div class="form-group">
                <label for="customer-phone"><i class="fas fa-phone"></i> Phone Number</label>
                <input type="text" id="customer-phone" placeholder="Enter phone number">
            </div>
            <div class="form-group">
                <label for="customer-email"><i class="fas fa-envelope"></i> Email Address</label>
                <input type="text" id="customer-email" placeholder="Enter email address">
            </div>
        </div>
        <div class="button-group">
            <button class="btn btn-save" onclick="saveCustomer()">
                <i class="fas fa-save"></i>
                <span>Save Customer</span>
            </button>
            <button class="btn btn-update" onclick="updateCustomer()">
                <i class="fas fa-edit"></i>
                <span>Update Customer</span>
            </button>
            <button class="btn btn-delete" onclick="deleteCustomer()">
                <i class="fas fa-trash-alt"></i>
                <span>Delete Customer</span>
            </button>
            <button class="btn btn-reset" onclick="resetForm()">
                <i class="fas fa-redo"></i>
                <span>Reset Form</span>
            </button>
        </div>
    </div>
    <!-- TABLE CARD -->
    <div class="table-card">
        <div class="table-header">
            <div class="table-title">
                <i class="fas fa-table"></i>
                Customer List
            </div>
            <div class="table-search">
                <i class="fas fa-search"></i>
                <input type="text" id="tableSearch" placeholder="Search customers..." oninput="searchTable()">
            </div>
        </div>
        <div class="table-container">
            <table id="customer-table">
                <thead>
                <tr>
                    <th><i class="fas fa-id-badge"></i> Customer ID</th>
                    <th><i class="fas fa-user"></i> Name</th>
                    <th><i class="fas fa-map-marker-alt"></i> Address</th>
                    <th><i class="fas fa-phone"></i> Phone</th>
                    <th><i class="fas fa-envelope"></i> Email</th>
                </tr>
                </thead>
                <tbody id="customer-table-body">
                <tr class="no-data">
                    <td colspan="5">
                        <div class="loading"></div>
                        <br>Loading customers...
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</main>
<script src="../js/jquery-3.7.1.min.js"></script>
<script>
    $(document).ready(function() {
        console.log('Page loaded, fetching customers...');
        getAllCustomer();
        // Row click event for selection
        $(document).on('click', '#customer-table-body tr:not(.no-data)', function() {
            $('#customer-table-body tr').removeClass('selected');
            $(this).addClass('selected');
            const cid = $(this).find('td:eq(0)').text();
            const cname = $(this).find('td:eq(1)').text();
            const caddress = $(this).find('td:eq(2)').text();
            const cphone = $(this).find('td:eq(3)').text();
            const cemail = $(this).find('td:eq(4)').text();
            $('#customer-id').val(cid);
            $('#customer-name').val(cname);
            $('#customer-address').val(caddress);
            $('#customer-phone').val(cphone);
            $('#customer-email').val(cemail);
        });
    });
    function showToast(type, title, message) {
        const toast = $(`
            <div class="toast ${type}">
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <div class="toast-content">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
            </div>
        `);
        $('body').append(toast);
        setTimeout(() => {
            toast.fadeOut(400, function() {
                $(this).remove();
            });
        }, 3000);
    }
    function saveCustomer() {
        if (!$('#customer-id').val()) {
            showToast('error', 'Validation Error', 'Please enter Customer ID');
            return;
        }
        if (!$('#customer-name').val()) {
            showToast('error', 'Validation Error', 'Please enter Customer Name');
            return;
        }
        const data = {
            cid: $('#customer-id').val(),
            cname: $('#customer-name').val(),
            caddress: $('#customer-address').val(),
            cphone: $('#customer-phone').val(),
            cemail: $('#customer-email').val()
        };
        $.ajax({
            url: "http://localhost:8080/POS_Backend_Web_exploded/customer",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function(response) {
                showToast('success', 'Success!', 'Customer saved successfully');
                resetForm();
                getAllCustomer();
            },
            error: function(xhr) {
                showToast('error', 'Error', xhr.responseText || 'Failed to save customer');
            }
        });
    }
    function updateCustomer() {
        if (!$('#customer-id').val()) {
            showToast('error', 'Validation Error', 'Please select a customer to update');
            return;
        }
        const data = {
            cid: $('#customer-id').val(),
            cname: $('#customer-name').val(),
            caddress: $('#customer-address').val(),
            cphone: $('#customer-phone').val(),
            cemail: $('#customer-email').val()
        };
        $.ajax({
            url: "http://localhost:8080/POS_Backend_Web_exploded/customer",
            method: "PUT",
            contentType: "application/json",
            data: JSON.stringify(data),
            success: function(response) {
                showToast('success', 'Success!', 'Customer updated successfully');
                resetForm();
                getAllCustomer();
            },
            error: function(xhr) {
                showToast('error', 'Error', xhr.responseText || 'Failed to update customer');
            }
        });
    }
    function deleteCustomer() {
        const cid = $('#customer-id').val();
        if (!cid) {
            showToast('error', 'Validation Error', 'Please select a customer to delete');
            return;
        }
        if (!confirm('Are you sure you want to delete this customer?')) {
            return;
        }
        $.ajax({
            url: 'http://localhost:8080/POS_Backend_Web_exploded/customer?cid=' + cid,
            method: "DELETE",
            success: function(response) {
                showToast('success', 'Success!', 'Customer deleted successfully');
                resetForm();
                getAllCustomer();
            },
            error: function(xhr) {
                showToast('error', 'Error', xhr.responseText || 'Failed to delete customer');
            }
        });
    }
    function getAllCustomer() {
        $.ajax({
            url: 'http://localhost:8080/POS_Backend_Web_exploded/customer',
            method: "GET",
            dataType: "json",
            success: function(response) {
                $('#customer-table-body').empty();
                if (!response || response.length === 0) {
                    $('#customer-table-body').html(
                        '<tr class="no-data"><td colspan="5"><i class="fas fa-inbox"></i><br>No customers found</td></tr>'
                    );
                    return;
                }
                for (let customer of response) {
                    const row =
                        "<tr>" +
                        "<td>" + (customer.cid || '') + "</td>" +
                        "<td>" + (customer.cname || '') + "</td>" +
                        "<td>" + (customer.caddress || '') + "</td>" +
                        "<td>" + (customer.cphone || '') + "</td>" +
                        "<td>" + (customer.cemail || '') + "</td>" +
                        "</tr>";
                    $("#customer-table-body").append(row);
                }
            },
            error: function(xhr, status, error) {
                $('#customer-table-body').html(
                    '<tr class="no-data"><td colspan="5"><i class="fas fa-exclamation-triangle"></i><br>Error loading customers</td></tr>'
                );
                showToast('error', 'Error', 'Failed to load customers');
            }
        });
    }
    function resetForm() {
        $('#customer-id').val('');
        $('#customer-name').val('');
        $('#customer-address').val('');
        $('#customer-phone').val('');
        $('#customer-email').val('');
        $('#customer-table-body tr').removeClass('selected');
    }
    function searchTable() {
        const searchTerm = $('#tableSearch').val().toLowerCase();
        $('#customer-table-body tr').each(function() {
            const rowText = $(this).text().toLowerCase();
            $(this).toggle(rowText.includes(searchTerm));
        });
    }
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('collapsed');
    }
    function logout() {
        if (confirm('Are you sure you want to logout?')) {
            window.location.href = 'login.html';
        }
    }
</script>
</body>
</html>